

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generate MESH and INCON files &mdash; toughio 1.3.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Generate model parameters input file" href="3_generate_model_parameters_input_file.html" />
    <link rel="prev" title="Generate mesh in Python with Gmsh" href="1_generate_mesh_in_python_with_gmsh.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> toughio
          

          
          </a>

          
            
            
              <div class="version">
                1.3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../gallery/index.html">Gallery</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">CO<sub>2</sub> leakage along a fault</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="1_generate_mesh_in_python_with_gmsh.html">Generate mesh in Python with Gmsh</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generate MESH and INCON files</a></li>
<li class="toctree-l3"><a class="reference internal" href="3_generate_model_parameters_input_file.html">Generate model parameters input file</a></li>
<li class="toctree-l3"><a class="reference internal" href="4_import_and_visualize_simulation_outputs_in_pyvista.html">Import and visualize simulation outputs in PyVista</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">toughio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../gallery/index.html">Gallery</a> &raquo;</li>
        
          <li><a href="index.html">CO<sub>2</sub> leakage along a fault</a> &raquo;</li>
        
      <li>Generate MESH and INCON files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/co2_leakage_along_a_fault/2_generate_mesh_and_incon_files.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-co2-leakage-along-a-fault-2-generate-mesh-and-incon-files-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="generate-mesh-and-incon-files">
<span id="sphx-glr-examples-co2-leakage-along-a-fault-2-generate-mesh-and-incon-files-py"></span><h1>Generate MESH and INCON files<a class="headerlink" href="#generate-mesh-and-incon-files" title="Permalink to this headline">¶</a></h1>
<p>In this example, we assume that the mesh has already been generated by a third-party software (here Gmsh via <code class="xref py py-mod docutils literal notranslate"><span class="pre">pygmsh</span></code>).</p>
<p>First, we import <code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">toughio</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">toughio</span>
</pre></div>
</div>
<p>A supported mesh can be read using the function <a class="reference internal" href="../../api/mesh.html#toughio.read_mesh" title="toughio.read_mesh"><code class="xref py py-func docutils literal notranslate"><span class="pre">toughio.read_mesh()</span></code></a> that returns a <a class="reference internal" href="../../api/mesh.html#toughio.Mesh" title="toughio.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">toughio.Mesh</span></code></a> object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span> <span class="o">=</span> <span class="n">toughio</span><span class="o">.</span><span class="n">read_mesh</span><span class="p">(</span><span class="s2">&quot;mesh.msh&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The mesh used in this sample problem is 2D and has been defined in the XY plane, but the points have 3D coordinates (with zeros as 3rd dimension for every cells). To make it 3D in the XZ plane, we swap the 2nd and 3rd dimensions, and then extrude the mesh by 1 meter along the Y axis (2nd dimension).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">extrude_to_3d</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>(Optional) Before going any further, it is good practice to first check the quality of the mesh generated.
TOUGH does not use any geometrical coordinate system and assumes that the line connecting a cell with its neighbor is orthogonal to their common interface. <code class="xref py py-mod docutils literal notranslate"><span class="pre">toughio</span></code> provides a mesh property that measures the quality of a cell as the average absolute cosine angle between the line connecting a cell with its neighbor and the normal vector of the common interface.
The mesh used in this example is of rather good quality. Bad quality cells are located at the boundaries of the model and mostly belong to the material <cite>“BOUND”</cite>. As this material is only used to impose Dirichlet boundary conditions in TOUGH, these bad quality cells will not impact the simulation outputs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyvista</span>
<span class="n">pyvista</span><span class="o">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="s2">&quot;document&quot;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">pyvista</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">))</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
    <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span>
    <span class="n">scalars</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">qualities</span><span class="p">,</span>
    <span class="n">stitle</span><span class="o">=</span><span class="s2">&quot;Average cell quality&quot;</span><span class="p">,</span>
    <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span>
    <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">view_xz</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="2 generate mesh and incon files" class="sphx-glr-single-img" src="../../_images/sphx_glr_2_generate_mesh_and_incon_files_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[(1005.0, -5504.599664394268, -1500.0),
 (1005.0, 0.5, -1500.0),
 (0.0, 0.0, 1.0)]
</pre></div>
</div>
<p>(Optional) Usually, a simple distribution plot is enough to rapidly assess the quality of a mesh.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">qualities</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">materials</span> <span class="o">!=</span> <span class="s2">&quot;BOUND&quot;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="2 generate mesh and incon files" class="sphx-glr-single-img" src="../../_images/sphx_glr_2_generate_mesh_and_incon_files_002.png" />
<p>We start by defining the boundary conditions. <code class="xref py py-mod docutils literal notranslate"><span class="pre">toughio</span></code> recognizes the cell data key <cite>“boundary_condition”</cite> and automatically imposes Dirichlet boundary conditions to cells that have any value other than 0 in this cell data array.
In this example, we simply set 1 to cells that belong to the group <cite>“BOUND”</cite> and 0 to others.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">materials</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">materials</span>
<span class="n">bcond</span> <span class="o">=</span> <span class="p">(</span><span class="n">materials</span> <span class="o">==</span> <span class="s2">&quot;BOUND&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">add_cell_data</span><span class="p">(</span><span class="s2">&quot;boundary_condition&quot;</span><span class="p">,</span> <span class="n">bcond</span><span class="p">)</span>
</pre></div>
</div>
<p>Initial conditions can be defined as a cell data array associated to key <cite>“initial_condition”</cite> where each column of the array corresponds to a primary variable. Note that <code class="xref py py-mod docutils literal notranslate"><span class="pre">toughio</span></code> will not write any initial condition value that is lower than the threshold flag -1.0e9.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">centers</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">centers</span>
<span class="n">incon</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_cells</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0e9</span><span class="p">)</span>
<span class="n">incon</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0e5</span> <span class="o">-</span> <span class="mf">9810.0</span> <span class="o">*</span> <span class="n">centers</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">incon</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">incon</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">incon</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">-</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="n">centers</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">add_cell_data</span><span class="p">(</span><span class="s2">&quot;initial_condition&quot;</span><span class="p">,</span> <span class="n">incon</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">toughio</span></code> also recognizes the cell data keys <cite>“porosity”</cite> and <cite>“permeability”</cite> in case we want to initialize porosity and/or permeability fields (e.g. if well logs data are available). Like boundary and initial conditions, we only have to associate new cell data arrays to keys <cite>“porosity”</cite> and/or <cite>“permeability”</cite>. The way these arrays are generated does not matter, they can be the results of simple interpolations (e.g. with <code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy</span></code>) or more advanced geostatistical interpolations (e.g. with <code class="xref py py-mod docutils literal notranslate"><span class="pre">pykrige</span></code>).</p>
<p>We can now write the <cite>MESH</cite> and <cite>INCON</cite> files by calling the method <a class="reference internal" href="../../api/mesh.html#toughio.Mesh.write_tough" title="toughio.Mesh.write_tough"><code class="xref py py-meth docutils literal notranslate"><span class="pre">toughio.Mesh.write_tough()</span></code></a>.
Additionally, we can also pickle the final mesh for later use (reading a pickle file is much faster than reading any mesh format).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span><span class="o">.</span><span class="n">write_tough</span><span class="p">(</span><span class="s2">&quot;MESH&quot;</span><span class="p">,</span> <span class="n">incon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mesh.pickle&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  6.356 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-co2-leakage-along-a-fault-2-generate-mesh-and-incon-files-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/bc8120366d54841073c38fdd6e2be0a5/2_generate_mesh_and_incon_files.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">2_generate_mesh_and_incon_files.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/6258f9bf7ed791dc86258c1ae6171c6f/2_generate_mesh_and_incon_files.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">2_generate_mesh_and_incon_files.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="3_generate_model_parameters_input_file.html" class="btn btn-neutral float-right" title="Generate model parameters input file" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="1_generate_mesh_in_python_with_gmsh.html" class="btn btn-neutral float-left" title="Generate mesh in Python with Gmsh" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Keurfon Luu

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>